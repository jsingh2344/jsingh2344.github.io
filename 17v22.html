<!DOCTYPE HTML>

<html>
	<head>
		<title>Tannehill and Henry</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />

		<!-- Favicon for most browsers -->
		<link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">

		<!-- Fallback for older browsers -->
		<link rel="icon" href="/favicon/favicon.ico" type="image/x-icon">

		<!-- Mobile / Apple devices -->
		<link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">

		<!-- language syntax support -->
		<link href="assets/css/prism.css" rel="stylesheet" />
		<script src="assets/js/prism.js"></script>
		
		<link rel="stylesheet" href="assets/css/main.css" />


	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Main -->
					<div id="main">
						<div class="inner">

							<!-- Header -->
								<header id="header">
									<a href="home" class="logo"><strong>Jaden Singh</strong></a>
									<ul class="icons">
										<li><a href="https://www.instagram.com/jadensingh.art/" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
	
									</ul>
								</header>

							<!-- Content -->
								<section>
									<header class="main">
										<h1>Tannehill and Henry</h1>
										<p>2021</p>
									</header>
									<p> <a href="https://github.com/jsingh2344/2020-17v22/blob/main/17v22.R">
										(Link to full script)
									</a></p>
									<div class="article">
										<p>After overhearing on the radio the Tennessee Titans losing to the Chiefs in the 2020 AFC championship game,
											for some reason I decided to make the Titans a primary interest of my life 
											over the next couple years. The Titans in those years were offensively driven, and largely
											relied on a strong rushing attack led by Derrick Henry. But their on-field success coincided
											with the arrival of veteran quarterback Ryan Tannehill, who particularly in 2019 and 2020 
											led passing offenses that ranked amongst the most efficient in the league.
										</p>
										<p>Derrick Henry, a Hall of Fame back with one of the best highlight reels in the league,
											was the more popular player of the two. As an annoying contrarian with preference for looking at some of the 
											more abstract football statistics, I thought Tannehill was probably more valuable. This was 
											a small project I put together to flesh out this comparison.
										</p>
										<p>
										<pre>
										<code class="language-r">
#load 2019-2021 data (Tannehill's tenure in Tennessee)
{
rt_pbp <- load_pbp(2019:2021)

titans_pbp <- rt_pbp %>%
filter(posteam == 'TEN') %>%
filter(rush == 1 | pass == 1) %>%
filter(!is.na(epa)) 
}
										</code>
										</pre>
									</p>
									<p>I first looked at Tennessee Titans offensive data from 2019 to 2021, using the 
										NFLFastR library, and then compared on 1st and 2nd down how much the Titans estimated 
										win percentage changed based on whether it was a pass from Tannehill or a rush from Henry.
									</p>
									<pre> <code class="language-r">
down_wpa_epa <- titans_pbp %>% 
  filter(passer == "R.Tannehill" | rusher == "D.Henry", down < 3) %>%
  group_by(down, name) %>%
  summarize(
    mean_epa = mean(epa), plays = n(), wpa_per30 = mean(wpa) * 30
  )

down_split_wpa_bar <- ggplot(down_wpa_epa, aes(fill=name, x=down, y=wpa_per30)) +
  geom_bar(position='dodge', stat='identity') +
  geom_text(aes(label = down), position = position_dodge(0.9))

down_split_wpa_bar <- down_split_wpa_bar + theme(
  axis.text.x = element_blank())
down_split_wpa_bar <- down_split_wpa_bar +
  labs(title = "Win % Added per 30 Plays: Ryan Tannehill and Derrick Henry",
       subtitle = "Win percentage between 10 and 90%, down < 3",
       caption = "Data from NFLFastR")
down_split_wpa_bar
									</code>
									</pre>

									<img src="images/17v22 Album/wpaPer30.png" class="content-image">
									<p>Plotting the result gives, in context, a very normal result -- considered independently,
										passing is 
										more efficient than running in most cases. The EPA (expected points added)
										splits are similar:
									</p>
									<pre>
										<code class="language-r">
down_split_epa_bar <- ggplot(down_wpa_epa, aes(fill=name, x=down, y=mean_epa)) +
  geom_bar(position='dodge', stat='identity') +
  geom_text(aes(label = down), position = position_dodge(0.9))

down_split_epa_bar <- down_split_epa_bar + theme(
  axis.text.x = element_blank()) +
  labs(title = "EPA Splits: Tannehill passes, Henry runs",
       subtitle = "down < 3, 10 < wpa < 90",
       caption = "NFLFastR")
down_split_epa_bar
										</code>
									</pre>
									<img src="images/17v22 Album/epaSplits.png" class="content-image">
									<p>But how do Tannehill and Henry compare to their peers around the league? 
										Who is outperforming their own competition? Here is a very basic look at 
										how Henry stacked up to other rushers from 2018 to 2021 (Henry became the starter
										in 2018):
									</p>
									<pre>
										<code class="language-r">
rb <- load_pbp(2018:2021) %>%
	filter(play_type == 'run') %>%
	filter(!is.na(rusher_player_name)) %>%
	group_by(rusher_player_name) %>%
	summarize(
	epa = mean(epa), carries = n()
	) %>%
	filter(carries > 100) %>%
	arrange(-carries)
rushing_effectiveness <- ggplot(rb, aes(x=carries, y=epa, fill = epa)) +
      geom_point(aes(color = epa)) +
      geom_text(aes(label=rusher_player_name),hjust=0, vjust=0)
    rushing_effectiveness
										</code>
									</pre>
									<img src="images/17v22 Album/2018-2021_rushing.png" class="content-image">
									And Tannehill (choosing 2019 as the lower time bound, since that is when Tannehill joined the Titans):
									<pre>
										<code class="language-r">
wp_tannehill <- load_pbp(2019:2021) %>%
      filter(play_type == 'pass') %>% 
      group_by(passer_player_name) %>%
      summarize(
        mean_wpa = mean(wpa) * 30, plays = n(), team=posteam, epa=epa) %>%
      arrange(-mean_wpa) %>%
      ungroup() %>%
      filter(plays > 450) 
    
    head(teams_colors_logos)
    
    wp_tannehill <- wp_tannehill %>%
      left_join(teams_colors_logos, by = c('team' = 'team_abbr'))
qb_wp <- wp_tannehill %>%
    ggplot(aes(x = mean_wpa, y = fct_reorder(passer_player_name, mean_wpa))) + 
    #geom_image(aes(image = team_logo_espn), size = wp$plays / 450, asp = 16 / 9)
    geom_point(color = wp_tannehill$team_color, size = wp_tannehill$plays / 450) + 
    labs(x = "WPA per 30 plays",
         y = "QBs",
         title = "Quarterback WPA, 2019-2021",
         caption = "Data: @nflfastR") +
    theme_bw()
  qb_wp
										</code>
									</pre>
									<img src="images/17v22 Album/qb_wpa_2019-2021.png" class="content-image">
									<p>Looking at these two plots, Henry is the clear outlier, while Tannehill
										looks more like a good-but-not great player at his position. Still, the success 
										of each rush attempt depends on the threat who is under center, and vice versa.
										So I next took a look on the relationship between a good running attack and a good passing attack.
									 </p>
									 <pre>
										<code class="language-r">
{
  home_correlation <- titans_pbp %>%
    filter(passer == "R.Tannehill" | rusher == "D.Henry", down < 4) %>%
    filter(play_type == 'run' | play_type == 'pass', home_team == 'TEN') %>%
    group_by(game_id) %>%
    summarize(
      rush_epa = last(total_home_rush_epa),
      pass_epa = last(total_home_pass_epa)
    ) 


#when TEN is away
away_correlation <- titans_pbp %>%
  filter(passer == "R.Tannehill" | rusher == "D.Henry", down < 4) %>%
  filter(play_type == 'run' | play_type == 'pass', home_team != 'TEN') %>%
  group_by(game_id) %>%
  summarize(
    rush_epa = last(total_away_rush_epa),
    pass_epa = last(total_away_pass_epa)
  ) 



} 
#nope_home plot:
{
home_correlation_dotplot <- ggplot(home_correlation, aes(x=rush_epa, y=pass_epa))  +
  geom_point(aes(color='000000')) +
  geom_smooth(se = FALSE, color = "black", method = "lm") +
  labs(title = "Titans Home Offensive Passing EVA vs Rushing EPA",
       caption = "data from NFLFasR")
home_correlation_dotplot
}
#nope_away plot:
{
away_correlation_dotplot <- ggplot(away_correlation, aes(x=rush_epa, y=pass_epa))  +
  geom_point(aes(color='000000')) +
  geom_smooth(se = FALSE, color = "black", method = "lm") +
  labs(title = "Titans Away Offensive Passing EVA vs Rushing EPA",
        caption = "data from NFLFasR")
away_correlation_dotplot
}
										</code>
									 </pre>
									 <img src="images/17v22 Album/nope-home.png" class="content-image">
									 <img src="images/17v22 Album/nope-away.png" class="content-image">
									 <p>
										A very rudimentary look at this question shows that when the Titans have more rushing EPA,
										it isn't a strong predictor of their passing EPA. But these are EPA totals, and when the Titans
										run the ball more, they can't also pass more at the same time. 
									 </p>
									 <pre>
										<code class="language-r">
attempt_correlation <- titans_pbp %>%
  filter(passer == "R.Tannehill" | rusher == "D.Henry", down < 4) %>%
  filter(play_type == 'run' | play_type == 'pass') %>%
  group_by(game_id) %>%
  summarize(
    rush_attempts = last(sum(rush_attempt)),
    pass_success_epa = last(sum(epa))
  ) 
attempt_correlation_dotplot <- attempt_correlation %>%
  ggplot(aes(x=rush_attempts, y=pass_success_epa)) +
  geom_point(aes(color='00ff00')) +
  geom_smooth(se = FALSE, color = "black", method = "lm") +
  labs(title = "Do rushing attempts correlate with passing success?",
       subtitle = "Titans Offense, 2019-2021",
       caption = "Data from NFLFastR")
attempt_correlation_dotplot
										</code>
									 </pre>
									 <img src="images/17v22 Album/rush-pass-corr.png" class="content-image">
									 <p>
										Another approach shows that more rushing attempts did correlate with higher passing success.
										However, that can be explained away by winning teams tending to run it more late in the game to 
										burn the clock, and when the passing game is successful, it is likely that you are winning. 
									 </p>
									 <pre>
										<code class="language-r">
wpadjusted_pbp <- titans_pbp %>%
  filter(vegas_wp < 80) %>%
  filter(score_differential < 9)

attempt_correlation_adjusted <- wpadjusted_pbp %>%
  filter(passer == "R.Tannehill" | rusher == "D.Henry", down < 4) %>%
  filter(play_type == 'run' | play_type == 'pass') %>%
  group_by(game_id) %>%
  summarize(
    rush_attempts = last(sum(rush_attempt)),
    pass_success_epa = last(sum(epa)),
  ) 
attempt_correlation_graph <-
  ggplot(attempt_correlation_adjusted, aes(x=rush_attempts, y=pass_success_epa)) +
  geom_point(aes(color='00ff00')) +
  geom_smooth(se = FALSE, color = "black", method = "lm") +
  labs(title ="Does passing success correlate with rushing attempts outside of garbage time?",
       subtitle = "Vegas WP under 80%",
       caption = "data from NFLFastR")
attempt_correlation_graph
										</code>
									 </pre>
									 <img src="images/17v22 Album/rush-pass-corr-no-garb.png" class="content-image">
									 <p>
										...And when you cut out garbage time, when a lot of 
										the clock-burning rush attempts are made, the correlation is less dramatic.
									 </p>
									 <pre>
										<code class="language-r">
#Explore correlation between play action and rushing success for the season of 2020
{
playaction <- scrapR %>%
  filter(season == 2020) %>%
  summarize (
    plays = pass_attempts, yards_per_pa = pa_pass_yards / pa_pass_att, player = player, team = team
  ) %>%
  filter(plays > 70)

runavg_2020 <- load_pbp(2020) %>%
  filter(play_type == 'run') %>%
  group_by(posteam) %>%
  summarize(
    avg = mean(yards_gained)
  )

names(runavg_2020)[names(runavg_2020) == 'posteam'] <- 'team'

PAvRun <- merge(runavg_2020, playaction, by='team')

PAvRun$Col <- rbPal(10)[as.numeric(cut(PAvRun$yards_per_pa, breaks = 10))]

PAvRun_dotplot <- PAvRun %>% 
  ggplot(aes(x=avg, y=yards_per_pa)) +
  geom_point(size = PAvRun$plays / 250, color = PAvRun$Col) +
  geom_smooth(se = FALSE, color = "black", method = "lm") +
  labs(title = "2020 PA versus Rushing Efficiency",
       caption = "Data from PFR and NFLFastR")
PAvRun_dotplot

}
										</code>
									 </pre>
									 <img src="images/17v22 Album/PAvRush.png" class="content-image">
									 <p>
										A look at the entire league shows that in general, there is an association between
										play action and rushing efficiency.
									 </p>
									 <p>Next, I examined how Tannehill performed with and without the threat of a Henry rush attempt.
										First, his performance out of the shotgun formation, now using Sportradar charting data:
									 </p>
									 <pre>
										<code class="language-r">
SR_2021_pbp <- readRDS("/Users/jsingh23/Desktop/R/Sportradar/Data/pbp_2020.rds")
  SR_2021_part <- readRDS("/Users/jsingh23/Desktop/R/Sportradar/Data/participation_2020.rds")
  fastr20 <- load_pbp(2020) 
  SR_2021_pbp$game_id <- str_replace_all(SR_2021_pbp$game_id, "JAC", "JAX")
  merged_SR <- merge(SR_2021_pbp, SR_2021_part, by="sr_id")
  merged_SR <- merged_SR %>%
    mutate(play_id = play_id.x)
  SR_fastr <- merge(merged_SR, 
              load_pbp(2020), 
              by=c("play_id", 
              "game_id"))
  SR_fastr %>% saveRDS("/Users/jsingh23/Desktop/R/SR_fastr")
  SR_fastr <- readRDS("/Users/jsingh23/Desktop/R/SR_fastr")

league_shotgun <- SR_fastr %>%
    filter(shotgun == 1) %>%
    filter(!is.na(passer_player_name)) %>%
    group_by(passer_player_name) %>%
    summarize(
     epa = mean(epa), plays = n(), box = mean(men_in_box)
    ) %>%
    filter(plays > 70) %>%
    arrange(-epa) 

shotgun_graph <- league_shotgun %>%
    filter(plays > 200) %>%
    arrange(-epa) %>%
    filter(!is.na(box)) %>%
    mutate(across(starts_with("box"), round, 1)) %>%
    ggplot(aes(x=reorder(passer_player_name, -epa), y=epa)) + 
    geom_point(size = 3, aes(color = factor(epa))) + 
    geom_segment(aes(x=passer_player_name, 
                     xend=passer_player_name, 
                     y=0, 
                     yend=epa)) +
    theme(axis.text.x = element_text(angle=65, vjust=0.6)) +
    theme(legend.position = "none") +
    geom_text(aes(label = box), position = position_nudge(y = 0.03), alpha = 1, color = "skyblue") +
    labs(title = "2020 Selected Quarterbacks EPA/Play Out of Shotgun", subtitle = "Labels represent average number of men in box",
         y = "EPA/Play", x = "Passer", caption = "Data from Sportradar and NFLFastR")
    shotgun_graph
										</code>
									 </pre>
									 <img src="images/17v22 Album/shotgun.png" class="content-image">
									 <p>
										Surprisingly, Tannehill was one of the most effective quarterbacks in the league out of shotgun,
										and without an outlier number of defenders in the box. Next, how the offense performed split by
										whether Derrick Henry was on or off the field at all:
									 </p>
									 <pre>
										<code class="language-r">
 DH_On <- SR_fastr %>%
   filter(posteam == "TEN") %>%
   filter(grepl("Derrick Henry", home_names, fixed=TRUE) | 
            grepl("Derrick Henry", away_names, fixed=TRUE)) %>%
   mutate(DH = 1)
 DH_Off <- SR_fastr %>%
   filter(posteam == "TEN") %>%
   filter(play_type == "run" | play_type == "pass") %>%
   filter(!grepl("Derrick Henry", home_names, fixed=TRUE) & 
            !grepl("Derrick Henry", away_names, fixed=TRUE)) %>%
   mutate(DH = 0)
 participation_22 <- rbind(DH_Off, DH_On)

  DH_splits_density <- participation_22 %>% ggplot(aes(x=epa, group=DH, fill = DH)) +
          geom_density(adjust=1.5, alpha=.4) +
   theme_few() +
   theme(legend.position = "none") +
   labs(title = "The Titans 2020 Offense - Derrick Henry Splits",
        subtitle = "Plays with Henry on the field are represented by blue; without, by grey. 
Early downs, win percentage between 5 and 95 percent. Two minute drills are excluded",
        caption = "Data from Sportradar and NFLFastR") +
   theme(plot.subtitle=element_text(size=10))
    DH_splits_density
										</code>
									 </pre>
									 <img src="images/17v22 Album/image4.png" class="content-image">
									 <pre>
										<code class="language-r">
DH_passing <- participation_22 %>%
     filter(down == 1 | down == 2) %>%
     filter(play_type == "pass") %>%
     filter(half_seconds_remaining > 120) %>%
     filter(posteam == "TEN") %>%
     filter(wp > 5 | wp < 95) %>%
     group_by(DH) %>%
     summarize(
       passing_epa = mean(epa), passing_plays = n(), passing_success = mean(success)
     )
   DH_rushing <- participation_22 %>%
     filter(down == 1 | down == 2) %>%
     filter(play_type == "run") %>%
     filter(half_seconds_remaining > 120) %>%
     filter(posteam == "TEN") %>%
     filter(wp > 5 | wp < 95) %>%
     group_by(DH) %>%
     summarize(
       rushing_epa = mean(epa), rushing_plays = n(), rushing_success = mean(success)
     )
    
 DH_overall <- merge(DH_rushing, DH_passing, by="DH") 

DH_overall <- merge(DH_rushing, DH_passing, by="DH") 
 
 
 #Fit data for a bar graph:
 
 DH_overall <- as.data.frame(t(as.matrix(DH_overall)))
 DH_overall <- DH_overall %>%
   mutate(On = V2) %>%
   mutate(Off = V1)
 DH_overall$V1 <- NULL
 DH_overall$V2 <- NULL
 
 
 
 DH_overall <- rownames_to_column(DH_overall, var = "rowname")
 DH_barcomp <- pivot_longer(DH_overall, -rowname, names_to="variable", values_to="value")
 DH_barcomp <- DH_barcomp[-c(5, 6, 11, 12), ]
 DH_barcomp <- DH_barcomp[-c(1, 2), ]
   }#Getting summarized early down epa and success splits
 
 DH_splits_bar <- ggplot(DH_barcomp,aes(x = rowname,y = value)) + 
   geom_bar(aes(fill = variable),stat = "identity",position = "dodge") +
   labs(title = "2020 Titans Offense Derrick Henry On/Off Splits", subtitle = "Early downs, win percentage between 5 and 95 percent, two minute drills excluded",
        y = "Value", x = "Variable", caption = "Data from Sportradar and NFLFastR")

 DH_splits_bar
										</code>
									 </pre>
									 <img src="images/17v22 Album/on-off.png" class="content-image">
									 <p>
										The final analysis was a down-by-down look at how the offense performed with Henry on and off the field.
										The results did not indicate a large impact, but again with a lot of contextual holes.
										Fundamentally, plays with Henry on the field and with Henry off the field are not otherwise equal.
										Football has a massive number of external factors that would matter here. For example, Henry would likely 
										be off the field in two-minute drill situations where the defense might be willing to give
										up large plays that keep the clock running.
	
									 </p>
									</div>
								</section>

						</div>
					</div>

				<!-- Sidebar -->
				 	<div id="sidebar_standin"></div>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>